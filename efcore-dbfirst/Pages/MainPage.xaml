<Page x:Name="page" x:Class="efcore_dbfirst.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:efcore_dbfirst.Pages"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:converter="clr-namespace:efcore_dbfirst.Converters"
      xmlns:validator="clr-namespace:efcore_dbfirst.Validators"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="1000"
      Title="Товары электроники" Loaded="LoadList">
    
    <Page.Resources>
        <converter:TagConverter x:Key="tagConverter"/>
        <converter:ProductStockBorderConverter x:Key="borderConverter"/>

        <validator:PriceInMainPageValidator x:Key="priceInMainPageValidator"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <StackPanel Grid.Row="0" Grid.ColumnSpan="2">
            <Label Content="Поиск" FontWeight="SemiBold" Margin="8"/>
            <TextBox Text="{Binding searchQuery, UpdateSourceTrigger=PropertyChanged}" x:Name="searchText"
                     TextChanged="Search_TextChanged"
                     materialDesign:HintAssist.Hint="Введите текст для поиска"
                     Margin="8,0"/>
        </StackPanel>
        <StackPanel Grid.Row="1" Grid.Column="0" Margin="8">
            <Label Content="Сортировка" FontSize="20" FontWeight="SemiBold" Margin="8"/>
            <StackPanel>
                <Label Content="Цена"/>
                <ComboBox x:Name="PriceComboBox" SelectionChanged="Price_SelectionChanged">
                    <ComboBox.Items>
                        <ComboBoxItem Tag="ascendingPrice">По возврастанию</ComboBoxItem>
                        <ComboBoxItem Tag="descendingPrice">По убыванию</ComboBoxItem>
                    </ComboBox.Items>
                </ComboBox>
            </StackPanel>
            <StackPanel>
                <Label Content="Количество"/>
                <ComboBox x:Name="StockComboBox" SelectionChanged="Stock_SelectionChanged">
                    <ComboBox.Items>
                        <ComboBoxItem Tag="ascendingStock">По возврастанию</ComboBoxItem>
                        <ComboBoxItem Tag="descendingStock">По убыванию</ComboBoxItem>
                    </ComboBox.Items>
                </ComboBox>
            </StackPanel>
            <Label Content="Фильтрация" FontSize="20" FontWeight="SemiBold" Margin="8"/>
            <StackPanel>
                    <StackPanel>
                        <Label Content="Категория"/>
                        <ComboBox ItemsSource="{Binding Categories}"
                                  x:Name="CategoriesComboBox"
                                  SelectionChanged="CategoriesComboBox_SelectionChanged"
                                  DisplayMemberPath="Name"
                                  SelectedValuePath="Id"
                                  />
                    </StackPanel>
                <StackPanel>
                    <Label Content="Бренд"/>
                    <ComboBox ItemsSource="{Binding Brands}"
                              x:Name="BrandsComboBox"
                              SelectionChanged="BrandsComboBox_SelectionChanged"
                              DisplayMemberPath="Name"
                              SelectedValuePath="Id"
                              />
                </StackPanel>
            </StackPanel>
            <Label Content="Цена" FontSize="20" FontWeight="SemiBold" Margin="8"/>
            <StackPanel>
                <Label Content="От"/>
                <TextBox Text="{Binding filterPriceFrom, UpdateSourceTrigger=PropertyChanged}" x:Name="priceFromText"
                         materialDesign:HintAssist.Hint="Введите цену"
                         TextChanged="FilterPrice_TextChanged"/>
                <Label Content="До"/>
                <TextBox Text="{Binding filterPriceTo, UpdateSourceTrigger=PropertyChanged}" x:Name="priceToText"
                         materialDesign:HintAssist.Hint="Введите цену"
                         TextChanged="FilterPrice_TextChanged"/>
            </StackPanel>
            <Button Click="Reset" Content="Сбросить" Margin="8" Width="240"/>
            <Button Click="Add" Content="Добавить" x:Name="managerAddButton" Visibility="Visible" Margin="8" Width="240"/>
            <Button Click="Logout" Content="Выйти" Visibility="Visible" Margin="8" Width="240"/>
        </StackPanel>
        <ListView Grid.Row="1" Grid.Column="1"
                  ItemsSource="{Binding products}" Name="ProductsList"
                  HorizontalContentAlignment="Stretch"
                  MouseDoubleClick="ProductsList_MouseDoubleClick"
                  SelectedItem="{Binding product}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border
                        BorderThickness="2"
                        CornerRadius="6"
                        BorderBrush="{Binding Stock, Converter={StaticResource borderConverter}}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                                <RowDefinition Height="auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Row="0" Grid.Column="0">
                                <Run Text="{Binding Name}" FontWeight="Bold"/>
                            </TextBlock>
                            <TextBlock Grid.Row="0" Grid.Column="1">
                                <Run Text="Цена: "/>
                                <Run Text="{Binding Price, StringFormat={}{0:N2}}"/>
                            </TextBlock>

                            <TextBlock Grid.Row="1" Grid.Column="0">
                                <Run Text="★ "/>
                                <Run Text="{Binding Rating}"/>
                            </TextBlock>

                            <TextBlock Grid.Row="2" Grid.Column="0">
                                <Run Text="Категория: "/>
                                <Run Text="{Binding Category.Name}"/>
                            </TextBlock>

                            <TextBlock Text="{Binding Description}" Grid.Row="3" Grid.Column="0"/>
                            <TextBlock Grid.Row="3" Grid.Column="1">
                                <Run Text="Отстаток: "/>
                                <Run Text="{Binding Stock}"/>
                            </TextBlock>

                            <TextBlock Text="{Binding Tags, Converter={StaticResource tagConverter}}" FontWeight="Light" Grid.Row="4" Grid.Column="0"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <WrapPanel Background="LightGray" Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock Text="{Binding products.Count, StringFormat='{}Всего записей: {0}'}"
                       Margin="4"
                       VerticalAlignment="Center"/>
            <TextBlock Text="{Binding Items.Count, ElementName=ProductsList, StringFormat='{} Показано: {0}'}"
                       Margin="4"
                       VerticalAlignment="Center"/>
        </WrapPanel>
    </Grid>
</Page>
